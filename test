import allel
import matplotlib.pyplot as plt

# Load VCF file
vcf_path = 'my_data.vcf'
callset = allel.read_vcf(vcf_path, fields=['variants/POS', 'calldata/GT'])

# Extract genotypes
genotypes = allel.GenotypeArray(callset['calldata/GT'])

# Calculate allele frequencies
allele_counts = genotypes.count_alleles()
allele_frequencies = allele_counts.to_frequencies()

# Calculate correlation coefficients
print(genotypes[:,:,1])
print(genotypes[1])
print(genotypes[1].shape)
gn = genotypes.to_n_alt(fill=-1)
r = allel.rogers_huff_r(gn)

# Convert correlation coefficients to r^2 values
r2 = r ** 2

# Calculate distances between SNPs
distances = callset['variants/POS'][1:] - callset['variants/POS'][:-1]

# Calculate average r^2 for each distance bin
bin_size = 50000  # Adjust this value according to your data
binned_r2 = allel.stats.mean_per_bin(distances, r2, bins=range(0, max(distances) + bin_size, bin_size))

# Plot LD decay
plt.plot(binned_r2[0], binned_r2[1])
plt.xlabel('Distance (bp)')
plt.ylabel('Linkage Disequilibrium (r^2)')
plt.title('LD Decay Plot')
plt.show()
